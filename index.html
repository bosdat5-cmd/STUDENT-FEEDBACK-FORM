<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Feedback Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .form-page { display: none; }
    .form-page.active { display: block; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-3xl">
    <h1 class="text-2xl font-bold mb-6 text-center">ðŸ“‹ Student Feedback Form</h1>

    <form id="feedbackForm" class="space-y-6">

      <!-- ================= PAGE 1: BASIC INFO ================= -->
      <div class="form-page active" id="page1">
        <h2 class="text-lg font-semibold mb-4">Basic Information</h2>
        <input name="studentName" id="studentName" placeholder="Student Name" class="w-full border p-2 rounded mb-2" required>
        <input name="regNumber" id="regNumber" placeholder="Registration Number" class="w-full border p-2 rounded mb-2" required>
        <input name="mobile" id="mobile" type="tel" placeholder="Mobile (10 digits, starts with 6-9)" class="w-full border p-2 rounded mb-2" required>
        <input name="email" id="email" type="email" placeholder="Email" class="w-full border p-2 rounded mb-2" required>

        <button type="button" id="nextBtn1" class="bg-blue-500 text-white px-4 py-2 rounded">Next</button>
      </div>

      <!-- ================= PAGE 2: FACULTY ================= -->
      <div class="form-page" id="page2">
        <h2 class="text-lg font-semibold mb-4">Select Faculty</h2>
        <select name="facultyName" id="facultyName" class="w-full border p-2 rounded mb-4" required></select>

        <div class="flex justify-between">
          <button type="button" id="backBtn2" class="bg-gray-400 text-white px-4 py-2 rounded">Back</button>
          <button type="button" id="nextBtn2" class="bg-blue-500 text-white px-4 py-2 rounded">Next</button>
        </div>
      </div>

      <!-- ================= PAGE 3: FEEDBACK ================= -->
      <div class="form-page" id="page3">
        <h2 class="text-lg font-semibold mb-4">Feedback</h2>
        <input name="batchId" placeholder="Batch ID" class="w-full border p-2 rounded mb-4" required>

        <!-- QUESTIONS (all 19 as dropdowns 1-5) -->
        <div id="questionsContainer" class="space-y-4">
          <select name="Attendance & Punctuality" class="w-full border p-2 rounded" required>
            <option value="">Attendance & Punctuality</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Professional Image & Engagement" class="w-full border p-2 rounded" required>
            <option value="">Professional Image & Engagement</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Discipline" class="w-full border p-2 rounded" required>
            <option value="">Discipline</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Active Participation" class="w-full border p-2 rounded" required>
            <option value="">Active Participation</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Group Activities & Teamwork" class="w-full border p-2 rounded" required>
            <option value="">Group Activities & Teamwork</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Presentation - Content" class="w-full border p-2 rounded" required>
            <option value="">Presentation - Content</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Presentation - Delivery" class="w-full border p-2 rounded" required>
            <option value="">Presentation - Delivery</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Communication Skills" class="w-full border p-2 rounded" required>
            <option value="">Communication Skills</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Analytical Thinking" class="w-full border p-2 rounded" required>
            <option value="">Analytical Thinking</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Creativity & Innovation" class="w-full border p-2 rounded" required>
            <option value="">Creativity & Innovation</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Professional Ethics Awareness" class="w-full border p-2 rounded" required>
            <option value="">Professional Ethics Awareness</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Student-Faculty Interaction Quality" class="w-full border p-2 rounded" required>
            <option value="">Student-Faculty Interaction Quality</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Overall Engagement" class="w-full border p-2 rounded" required>
            <option value="">Overall Engagement</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Politeness & Courtesy" class="w-full border p-2 rounded" required>
            <option value="">Politeness & Courtesy</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Use of Real-World Examples" class="w-full border p-2 rounded" required>
            <option value="">Use of Real-World Examples</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Ease of Asking Questions" class="w-full border p-2 rounded" required>
            <option value="">Ease of Asking Questions</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Individual Attention to Students" class="w-full border p-2 rounded" required>
            <option value="">Individual Attention to Students</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
          <select name="Encourages and Motivates Students" class="w-full border p-2 rounded" required>
            <option value="">Encourages and Motivates Students</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          </select>
        </div>

        <!-- SCORES -->
        <input name="quizMarks" id="quizMarks" type="number" placeholder="Quiz Marks (out of 100)" class="w-full border p-2 rounded mt-4" required>
        <div class="mt-4 p-3 border rounded bg-gray-50">
          <p><b>Weighted Score:</b> <span id="weightedScore">0</span></p>
          <p><b>Grade:</b> <span id="grade">-</span></p>
        </div>
        <textarea name="comments" placeholder="Comments" class="w-full border p-2 rounded mt-4"></textarea>

        <div class="flex justify-between mt-4">
          <button type="button" id="backBtn3" class="bg-gray-400 text-white px-4 py-2 rounded">Back</button>
          <button type="button" id="nextBtn3" class="bg-blue-500 text-white px-4 py-2 rounded">Calculate</button>
        </div>
      </div>

      <!-- ================= PAGE 4: CONFIRMATION ================= -->
      <div class="form-page" id="page4">
        <h2 class="text-lg font-semibold mb-4">Confirm Submission</h2>
        <p>Please review your scores before submitting.</p>
        <div class="mt-4 p-3 border rounded bg-gray-50">
          <p><b>Average Score:</b> <span id="avgScoreFinal">0</span></p>
          <p><b>Weighted Score:</b> <span id="weightedScoreFinal">0</span></p>
          <p><b>Grade:</b> <span id="gradeFinal">-</span></p>
        </div>

        <div class="flex justify-between mt-4">
          <button type="button" id="backBtn4" class="bg-gray-400 text-white px-4 py-2 rounded">Back</button>
          <button type="button" id="submitBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Submit</button>
        </div>
      </div>

      <!-- ================= PAGE 5: THANK YOU ================= -->
      <div class="form-page" id="page5">
        <h2 class="text-xl font-bold text-center mb-4">ðŸŽ‰ Thank You!</h2>
        <p class="text-center">You have successfully completed feedback for all faculties.</p>
      </div>

    </form>
    <p id="status" class="mt-4 text-center text-gray-700"></p>
  </div>

  <script>
    // ========== PAGE HANDLING ==========
    const pages = document.querySelectorAll(".form-page");
    function showPage(index) { pages.forEach((p, i) => p.classList.toggle("active", i === index)); }

    document.getElementById("nextBtn1").onclick = () => {
      const mobile = document.getElementById("mobile").value.trim();
      if (!/^[6-9]\d{9}$/.test(mobile)) return alert("Invalid mobile number!");
      const email = document.getElementById("email").value.trim();
      if (!/^[^@]+@[^@]+\.[^@]+$/.test(email)) return alert("Invalid email!");
      showPage(1);
    };
    document.getElementById("backBtn2").onclick = () => showPage(0);
    document.getElementById("nextBtn2").onclick = () => showPage(2);
    document.getElementById("backBtn3").onclick = () => showPage(1);
    document.getElementById("nextBtn3").onclick = () => { calculateScores(); showPage(3); };
    document.getElementById("backBtn4").onclick = () => showPage(2);

    // ========== FACULTY LOOP ==========
    let faculties = ["Faculty 1","Faculty 2","Faculty 3","Faculty 4","Faculty 5","Faculty 6","Faculty 7"];
    function refreshFacultyDropdown() {
      const select = document.getElementById("facultyName");
      select.innerHTML = '<option value="">-- Select Faculty --</option>';
      faculties.forEach(f => { const opt = document.createElement("option"); opt.value = f; opt.textContent = f; select.appendChild(opt); });
    }
    refreshFacultyDropdown();

    // ========== SCORE CALCULATION ==========
    function calculateScores() {
      const qScores = Array.from(document.querySelectorAll("#questionsContainer select")).map(el => Number(el.value) || 0);
      const quiz = Number(document.getElementById("quizMarks").value) || 0;
      const avg = qScores.reduce((a,b)=>a+b,0) / qScores.length;
      const weighted = (avg*20 + quiz) / 2;
      let grade = "D"; if (weighted >= 85) grade = "A"; else if (weighted >= 70) grade = "B"; else if (weighted >= 50) grade = "C";
      document.getElementById("avgScore").innerText = avg.toFixed(2);
      document.getElementById("weightedScore").innerText = weighted.toFixed(2);
      document.getElementById("grade").innerText = grade;
      document.getElementById("avgScoreFinal").innerText = avg.toFixed(2);
      document.getElementById("weightedScoreFinal").innerText = weighted.toFixed(2);
      document.getElementById("gradeFinal").innerText = grade;
    }

    // ========== SUBMIT HANDLER ==========
    document.getElementById("submitBtn").onclick = () => {
      const formData = {};
      document.querySelectorAll("input, select, textarea").forEach(el => { if (el.name) formData[el.name] = el.value; });
      formData["averageScore"] = document.getElementById("avgScoreFinal").innerText;
      formData["weightedScore"] = document.getElementById("weightedScoreFinal").innerText;
      formData["grade"] = document.getElementById("gradeFinal").innerText;

      fetch("https://script.google.com/macros/s/AKfycby-pecNA2iTiza8agKnLJ2qlXtFS3zZNZD-M3cWe4Ch23hbGUD-HTwzDoFqVHkw7WAM/exec", { method: "POST", body: JSON.stringify(formData) })
      .then(() => {
        faculties = faculties.filter(f => f !== formData["facultyName"]);
        if (faculties.length > 0) { refreshFacultyDropdown(); document.getElementById("feedbackForm").reset(); showPage(1); }
        else { showPage(4); }
      })
      .catch(err => alert("Failed: " + err.message));
    };
  </script>
</body>
</html>

