<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ICAI Student Feedback</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Poppins', sans-serif; background: #f1f3f4; margin:0; padding:30px; display:flex; justify-content:center; align-items:flex-start; min-height:100vh;}
  .container { background:#fff; padding:30px 40px; border-radius:12px; width:650px; box-shadow:0 2px 8px rgba(0,0,0,0.15); }
  h1 { text-align:center; margin-bottom:25px; color:#202124; font-size:22px; }
  h2 { font-size:18px; font-weight:600; color:#202124; border-bottom:1px solid #dadce0; padding-bottom:8px; margin-bottom:20px; }
  label { font-weight:500; display:block; margin:12px 0 6px; color:#202124; }
  input, select, textarea { width:100%; padding:10px 12px; border:1px solid #dadce0; border-radius:6px; margin-bottom:15px; font-size:14px; }
  .btn { background:#1a73e8; color:#fff; border:none; border-radius:6px; padding:10px 20px; cursor:pointer; margin:8px 8px 0 0; }
  .btn:hover { background:#1558b0; }
  .form-page { display:none; }
  .active-page { display:block; }
  .question-block { background:#f8f9fa; border:1px solid #dadce0; border-radius:8px; padding:15px 18px; margin-bottom:18px; }
  #loader { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); z-index:9999; align-items:center; justify-content:center; }
  .spinner { border:6px solid #f3f3f3; border-top:6px solid #1a73e8; border-radius:50%; width:60px; height:60px; animation:spin 1s linear infinite; }
  @keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>
<div>
<h1>ICAI Student Feedback Form</h1>
<div class="container">

<!-- Page 1 -->
<div id="page1" class="form-page active-page">
  <h2>Basic Information</h2>
  <label>Student Name *</label>
  <input id="studentName" type="text">
  <label>Registration Number *</label>
  <input id="regNumber" type="text" placeholder="CRO1234567">
  <label>Email *</label>
  <input id="email" type="email">
  <label>Mobile Number *</label>
  <input id="mobile" type="tel" placeholder="10 digit number">
  <button class="btn" onclick="validatePage1()">Next ‚Üí</button>
</div>

<!-- Page 2 -->
<div id="page2" class="form-page">
  <h2>Select Faculty</h2>
  <select id="facultySelect"></select>
  <br>
  <button class="btn" onclick="showPage(1)">‚Üê Back</button>
  <button class="btn" onclick="validatePage2()">Next ‚Üí</button>
</div>

<!-- Page 3 -->
<div id="page3" class="form-page">
  <h2>Faculty Feedback</h2>
  <div class="question-block">
    <label>Batch ID *</label>
    <input id="batchId">
  </div>
  <div id="questionsContainer"></div>
  <div class="question-block">
    <label>Quiz Marks *</label>
    <input id="quizMarks" type="number" min="0" max="100" oninput="calculateScore()">
  </div>
  <div class="question-block">
    <p><b>Weightage Score:</b> <span id="weightageScore">0.00</span></p>
    <p><b>Grade:</b> <span id="grade">-</span></p>
  </div>
  <div class="question-block">
    <label>Additional Comments (Optional)</label>
    <textarea id="additionalComments" rows="3"></textarea>
  </div>
  <button class="btn" onclick="showPage(2)">‚Üê Back</button>
  <button class="btn" onclick="validatePage3()">‚úÖ Submit Feedback</button>
</div>

<!-- Page 4 -->
<div id="page4" class="form-page">
  <h2>üéâ Thank You!</h2>
  <p>Your feedback has been submitted for all faculties.</p>
</div>

</div>
</div>

<!-- Loader -->
<div id="loader"><div class="spinner"></div></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFoCXaitd0DO6obxsE8s4PSEMwD_9c6Zc2c7ol-y55LoOjpH2BOtk_qMdUlLcNE9np/exec"; // Replace with deployed web app URL
const faculties = ["Sandeep Agarwal","Bhanu Dhir","Shekhar Sharma","Anju Gupta","Preeti Goel","Rohit Agarwal","Sunita Rathore"];
let completedFaculties = [];

function showPage(n){
  document.querySelectorAll(".form-page").forEach(p=>p.classList.remove("active-page"));
  document.getElementById("page"+n).classList.add("active-page");
  if(n===2) loadFaculties();
  if(n===3) loadQuestions();
}

function validatePage1(){
  if(!studentNameEl().value.trim()||!regNumberEl().value.trim()||!emailEl().value.trim()||!mobileEl().value.trim()){
    return alert("Fill all fields"); }
  showPage(2);
}

function validatePage2(){
  if(!facultyEl().value) return alert("Select faculty");
  showPage(3);
}

function validatePage3(){
  if(!batchIdEl().value.trim()) return alert("Batch ID required");
  submitFeedback();
}

function loadFaculties(){
  const select = facultyEl();
  select.innerHTML = "<option value=''>--Select Faculty--</option>";
  faculties.filter(f=>!completedFaculties.includes(f)).forEach(f=>{
    const opt = document.createElement("option");
    opt.value = f; opt.textContent=f; select.appendChild(opt);
  });
  if(completedFaculties.length===faculties.length) showPage(4);
}

function loadQuestions(){
  const container = document.getElementById("questionsContainer");
  container.innerHTML = "";
  const ratingQ = ["Attendance & Punctuality","Discipline","Active Participation","Group Activities & Teamwork","Presentation - Content","Presentation - Delivery","Communication Skills","Analytical Thinking","Creativity & Innovation","Professional Ethics Awareness","Emotional Intelligence","Overall Engagement","Professional Dress Code"];
  const optionQ = ["Industry/ Practice real life examples","Accessibility for clarification","Personalised guidance","Inspiring / motivating"];
  ratingQ.forEach((q,i)=>container.innerHTML+=`<div class="question-block"><label>${q}*</label><select id="q${i}" onchange="calculateScore()"><option value="">--Select--</option><option value="20">POOR</option><option value="40">BELOW AVERAGE</option><option value="60">AVERAGE</option><option value="80">GOOD</option><option value="100">EXCELLENT</option></select></div>`);
  optionQ.forEach((q,i)=>container.innerHTML+=`<div class="question-block"><label>${q}*</label><select id="paraQ${i}" onchange="calculateScore()"><option value="">--Select--</option><option value="20">POOR</option><option value="40">BELOW AVERAGE</option><option value="60">AVERAGE</option><option value="80">GOOD</option><option value="100">EXCELLENT</option></select></div>`);
}

function calculateScore(){
  let total=0,count=0;
  for(let i=0;i<13;i++){ let v=parseInt(document.getElementById("q"+i)?.value||0,10); if(v){total+=v; count++;}}
  for(let i=0;i<4;i++){ let v=parseInt(document.getElementById("paraQ"+i)?.value||0,10); if(v){total+=v; count++;}}
  const avg = count>0?total/count:0;
  const quiz=parseFloat(quizEl().value||0);
  const weight=(avg+quiz)/2;
  document.getElementById("weightageScore").innerText=weight.toFixed(2);
  let grade="C"; if(weight>=85) grade="A+"; else if(weight>=70) grade="A"; else if(weight>=50) grade="B+"; else if(weight>=30) grade="B";
  document.getElementById("grade").innerText=grade;
}

function collectScores(){
  let obj={}; for(let i=0;i<13;i++){obj["Q"+(i+1)]=document.getElementById("q"+i).value||"";} for(let i=0;i<4;i++){obj["ParaQ"+(i+1)]=document.getElementById("paraQ"+i).value||"";} return obj;
}

function submitFeedback(){
  const answers={};
  for(let i=0;i<13;i++){answers["Q"+(i+1)]=document.getElementById("q"+i).value||"";}
  for(let i=0;i<4;i++){answers["ParaQ"+(i+1)]=document.getElementById("paraQ"+i).value||"";}

  const data={
    studentName: studentNameEl().value.trim(),
    regNumber: regNumberEl().value.trim(),
    email: emailEl().value.trim(),
    mobile: mobileEl().value.trim(),
    faculty: facultyEl().value,
    batchId: batchIdEl().value.trim(),
    quizMarks: quizEl().value.trim(),
    weightedScore: document.getElementById("weightageScore").innerText,
    grade: document.getElementById("grade").innerText,
    additionalComments: document.getElementById("additionalComments").value.trim(),
    answers: answers
  };

  document.getElementById("loader").style.display="flex";

  fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)})
    .then(res=>res.json())
    .then(res=>{
      document.getElementById("loader").style.display="none";
      if(res.status==="success"){
        completedFaculties.push(data.faculty);
        batchIdEl().value=""; quizEl().value=""; document.getElementById("additionalComments").value="";
        document.getElementById("questionsContainer").innerHTML=""; document.getElementById("weightageScore").innerText="0.00"; document.getElementById("grade").innerText="-";
        if(completedFaculties.length<faculties.length) showPage(2); else showPage(4);
      } else { alert("Submission failed: "+res.message);}
    })
    .catch(err=>{ document.getElementById("loader").style.display="none"; alert("Error submitting feedback: "+err);});
}

const studentNameEl=()=>document.getElementById("studentName");
const regNumberEl=()=>document.getElementById("regNumber");
const emailEl=()=>document.getElementById("email");
const mobileEl=()=>document.getElementById("mobile");
const facultyEl=()=>document.getElementById("facultySelect");
const batchIdEl=()=>document.getElementById("batchId");
const quizEl=()=>document.getElementById("quizMarks");

document.addEventListener("DOMContentLoaded",()=>showPage(1));
</script>
</body>
</html>
