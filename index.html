<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>THE INSTITUTE OF CHARTERED ACCOUNTANTS OF INDIA</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0077b6, #00b4d8);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      margin-top: 40px;
      padding: 30px;
      border-radius: 15px;
      width: 500px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      animation: fadeIn 0.5s ease-in-out;
    }
    h2 {
      text-align: center;
      color: #023e8a;
      margin-bottom: 20px;
      font-weight: 600;
    }
    h3 {
      color: #0077b6;
      margin-bottom: 15px;
    }
    label {
      font-weight: 500;
      display: block;
      margin: 8px 0 5px;
      color: #333;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      outline: none;
      font-size: 14px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }
    input:focus, select:focus {
      border-color: #00b4d8;
      box-shadow: 0 0 6px rgba(0,180,216,0.5);
    }
    .btn {
      display: inline-block;
      background: #0077b6;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      margin: 5px 5px 0 0;
      transition: all 0.3s;
    }
    .btn:hover {
      background: #023e8a;
      transform: scale(1.05);
    }
    .form-page { display: none; }
    .active-page { display: block; }
    .quote-box {
      background: #f1faff;
      padding: 20px;
      border-left: 5px solid #00b4d8;
      margin-top: 20px;
      border-radius: 10px;
      font-style: italic;
      color: #333;
    }
    .thankyou {
      text-align: center;
      color: #023e8a;
      font-size: 18px;
      font-weight: 600;
      margin-top: 10px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- Header -->
  <div class="text-center py-6 bg-blue-900 text-white shadow-lg">
    <h1 class="text-2xl font-bold uppercase">THE INSTITUTE OF CHARTERED ACCOUNTANTS OF INDIA</h1>
    <p class="text-lg mt-1">Student Feedback Form</p>
  </div>

  <div class="max-w-3xl mx-auto mt-6 bg-white p-8 rounded-2xl shadow-lg">

    <!-- Page 1: Basic Info -->
    <div id="page1" class="form-page active-page card">
      <h2 class="text-2xl font-semibold mb-4 text-blue-700">Basic Information</h2>
      <p class="text-gray-500 mb-6">Please fill in your details to proceed with feedback.</p>

      <label class="block mb-2 font-medium">Student Name <span class="text-red-500">*</span></label>
      <input id="studentName" type="text" class="w-full p-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Your full name">

      <label class="block mb-2 font-medium">Registration Number <span class="text-red-500">*</span></label>
      <input id="regNumber" type="text" class="w-full p-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="e.g. N/C/E/W/S/FRO1234567">

      <label class="block mb-2 font-medium">Email <span class="text-red-500">*</span></label>
      <input id="email" type="email" class="w-full p-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="example@email.com">

      <label class="block mb-2 font-medium">Mobile Number <span class="text-red-500">*</span></label>
      <input id="mobile" type="tel" class="w-full p-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="10 digit number"> 

      <div class="flex justify-end mt-6">
        <button type="button" class="btn-primary" onclick="validatePage1()">Next →</button>
      </div>
    </div>  

    <!-- Page 2: Faculty Selection -->
    <div id="page2" class="form-page card">
      <h2 class="text-2xl font-semibold mb-4 text-blue-700">Select Faculty</h2>
      <select id="facultySelect" class="w-full p-2 border rounded mb-6"></select>

      <div class="flex justify-between mt-6">
        <button type="button" class="btn-secondary" onclick="showPage(1)">← Back</button>
        <button type="button" class="btn-primary" onclick="validatePage2()">Next →</button>
      </div>
    </div>

    <!-- Page 3: Feedback -->
    <div id="page3" class="form-page card">
      <h2 class="text-2xl font-semibold mb-4 text-blue-700">Faculty Feedback</h2>

      <label class="block mb-2">Batch ID <span class="text-red-500">*</span></label>
      <input id="batchId" type="text" class="w-full p-2 border rounded mb-4">

      <div id="questionsContainer"></div>

      <label class="block mt-4 mb-2">Quiz Marks <span class="text-red-500">*</span></label>
      <input id="quizMarks" type="number" min="0" max="100" class="w-full p-2 border rounded mb-4" oninput="calculateScore()">

      <div class="p-4 bg-gray-50 rounded border mt-4">
        <p><b>Weightage Score:</b> <span id="weightageScore">0.00</span></p>
        <p><b>Grade:</b> <span id="grade">-</span></p>
      </div>
      <div class="mb-4">
        <label class="block mb-1">Additional Comments (Optional)</label>
        <textarea id="additionalComments" rows="3" class="w-full p-2 border rounded" placeholder="Write any comments here..."></textarea>
      </div>
      <div class="mb-4">
        <label class="block mb-1">Additional Comments (Optional)</label>
        <textarea id="additionalComments" rows="3" class="w-full p-2 border rounded" placeholder="Write any comments here..."></textarea>
      </div>
      
      <div class="flex justify-between mt-6">
        <button type="button" class="btn-secondary" onclick="showPage(2)">← Back</button>
        <button id="submitBtn" type="button" class="btn-primary" onclick="validateFeedback()">✅ Submit Feedback</button>
      </div>
    </div>

  </div>

<script>
/* ======= Cleaned JS for multi-page form (no nested <script> tags) ======= */

const faculties = ["Sandeep Agarwal","Bhanu Dhir","Shekhar Sharma","Anju Gupta","Preeti Goel","Rohit Agarwal","Sunita Rathore"];
let completedFaculties = [];
const questions = [
  "Attendance & Punctuality","Discipline","Active Participation",
  "Group Activities & Teamwork","Presentation - Content","Presentation - Delivery","Communication Skills",
  "Analytical Thinking","Creativity & Innovation","Professional Ethics Awareness","Emotional Intelligence","Overall Engagement","Professional Dress Code",
      "Industry/ Practice real life examples","Accessibility for clarification","Personalised guidance","Inspiring / motivating"
];

let currentPage = 1;

function showPage(n) {
  currentPage = n;
  document.querySelectorAll(".form-page").forEach(p => p.style.display = "none");
  document.getElementById("page"+n).style.display = "block";
  if(n===2) loadFaculties();
  if(n===3) loadQuestions();
}

function validatePage1(){
  const studentName = document.getElementById("studentName").value.trim();
  const regNumber = document.getElementById("regNumber").value.trim();
  const email = document.getElementById("email").value.trim();
  const mobile = document.getElementById("mobile").value.trim();
  
  if(!studentName || !regNumber || !email || !mobile){
    alert("⚠️ Please fill all fields");
    return;
  }

  const regPattern = /^(CRO|NRO|FRO|SRO|ERO|WRO)\d{7}$/i;
  if(!regPattern.test(regNumber)){
    alert("⚠️ Invalid Registration Number format!(CRO|NRO|FRO|SRO|ERO|WRO01234567)");
    return;
  }

  if(!/^[6-9]\d{9}$/.test(mobile)){
    alert("⚠️ Invalid mobile number!");
    return;
  }

  if(!email.includes("@") || !email.includes(".")){
    alert("⚠️ Invalid email address!");
    return;
  }

  // ✅ Only move if all checks pass
  showPage(2);  
}

function validatePage2() {
  const faculty = document.getElementById("facultySelect").value;
  if(!faculty){ 
    alert("⚠️ Please select a faculty!"); 
    return; 
  }
  showPage(3);
}

validateFeedback
function loadFaculties(){
  const select = document.getElementById("facultySelect");
  select.innerHTML = <option value="">-- Select Faculty --</option>;
  const available = faculties.filter(f=>!completedFaculties.includes(f));
  if(available.length===0){
    select.innerHTML=<option value="">No faculties left</option>;
    select.disabled=true;
  }else{
    available.forEach(f=>{
      const opt = document.createElement("option");
      opt.value = f;
      opt.textContent = f;
      select.appendChild(opt);
    });
    select.disabled=false;
  }
}

function loadQuestions() {
  const container = document.getElementById("questionsContainer");
  container.innerHTML = "";

  // --- Rating questions ---
  const ratingQuestions = [
    "Attendance & Punctuality",
    "Discipline",
    "Active Participation",
    "Group Activities & Teamwork",
    "Presentation - Content",
    "Presentation - Delivery",
    "Communication Skills",
    "Analytical Thinking",
    "Creativity & Innovation",
    "Professional Ethics Awareness",
    "Emotional Intelligence",
    "Overall Engagement",
    "Professional Dress Code"
  ];

  ratingQuestions.forEach((q, i) => {
    container.innerHTML += <div class="mb-4">
      <label class="block mb-1">${q} <span class="text-red-500">*</span></label>
      <select id="q${i}" class="w-full p-2 border rounded" onchange="calculateScore()">
        <option value="">--Select--</option>
        <option value="20">1. POOR</option>
        <option value="40">2. BELOW AVERAGE</option>
        <option value="60">3. AVERAGE</option>
        <option value="80">4. GOOD</option>
        <option value="100">5. EXCELLENT</option>
      </select>
    </div>;
  });

  // --- Option questions ---
  const optionQuestions = [
    "Industry/ Practice real life examples",
    "Accessibility for clarification",
    "Personalised guidance",
    "Inspiring / motivating"
  ];

  optionQuestions.forEach((q, i) => {
    const id = "paraQ" + i;
    container.innerHTML += <div class="mb-4">
      <label class="block mb-1">${q} <span class="text-red-500">*</span></label>
      <select id="${id}" class="w-full p-2 border rounded" onchange="calculateScore()">
        <option value="">--Select--</option>
        <option value="Excellent">Excellent</option>
        <option value="Good">Good</option>
        <option value="Average">Average</option>
        <option value="Poor">Poor</option>
      </select>
    </div>;
  });

  // --- Additional Comments (Optional) ---
  container.innerHTML += 
    <div class="mb-4">
      <label class="block mb-1">Additional Comments (Optional)</label>
      <textarea id="additionalComments" rows="3" class="w-full p-2 border rounded" placeholder="Write any comments here..."></textarea>
    </div>
  ;

  // --- Reset score display ---
  document.getElementById("weightageScore").innerText = "0.00";
  document.getElementById("grade").innerText = "-";
}
function calculateScore(){
  let total = 0, count = 0;

  // --- First 13 rating questions ---
  for (let i = 0; i < 13; i++){
    const val = parseInt(document.getElementById("q" + i)?.value || 0, 10);
    if(val){ total += val; count++; }
  }

  // --- Last 4 option questions ---
  for (let i = 0; i < 4; i++){
    const valStr = document.getElementById("paraQ" + i)?.value || "";
    let val = 0;
    if(valStr === "Excellent") val = 100;
    else if(valStr === "Good") val = 80;
    else if(valStr === "Average") val = 60;
    else if(valStr === "Poor") val = 40;

    if(val){ total += val; count++; }
  }

  // --- Average score calculation ---
  const avg = count > 0 ? total / count : 0;
  const quiz = parseFloat(document.getElementById("quizMarks")?.value || 0);
  const weightage = (avg + quiz) / 2;
  document.getElementById("weightageScore").innerText = weightage.toFixed(2);

  // --- Grade assignment ---
  let grade = "C";
  if(weightage >= 85) grade = "A+";
  else if(weightage >= 70) grade = "A";
  else if(weightage >= 50) grade = "B+";
  else if(weightage >= 30) grade = "B";
  document.getElementById("grade").innerText = grade;
}

/* Initialize after DOM ready */
document.addEventListener('DOMContentLoaded', () => {
  showPage(1);
  // (faculties/questions are loaded automatically when you land on their pages)
});
</script>
</body>
</html>
